services:
  server:
    build:
      dockerfile: Dockerfile
      target: prod
    container_name: server
    command: /job-orchestrator server
    environment:
      # Location inside the container where the data will be saved
      DATA_PATH: /opt/data
      # Location inside the container where the db will be saved
      DB_PATH: /opt/data/db.sqlite
      # Max age of folders (in seconds)
      MAX_AGE: 172800
      # Services #==================================================#
      SERVICE_EXAMPLE_UPLOAD_URL: http://example:9000/submit
      SERVICE_EXAMPLE_DOWNLOAD_URL: http://example:9000/retrieve
      SERVICE_EXAMPLE_RUNS_PER_USER: 5
      #=============================================================#
    ports:
      - "5000:5000"
    volumes:
      - orchestrator-data:/opt/data
    networks:
      - api
      - public

  example:
    build:
      dockerfile: Dockerfile
      target: example
    command: /job-orchestrator client
    container_name: example
    ports:
      - "9000:9000"
    networks:
      - api

networks:
  public:
    internal: false
  api:
    internal: true

volumes:
  orchestrator-data:
